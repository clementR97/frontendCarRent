<!-- <div class="login-wrapper">
    <div class="login-container">
      <button class="close-btn" (click)="goToHome()" aria-label="Retour à l'accueil">
        <mat-icon>close</mat-icon>
      </button>
      
      <div class="login-header">
        <div class="logo-container">
          <div class="logo-icon"></div>
        </div>
        <h1 class="login-title">Nouveau mot de passe</h1>
         -->
        <!-- Message de succès -->
        <!-- <div class="success-message" *ngIf="showSuccessMessage">
          <div class="success-icon">
            <mat-icon>check_circle</mat-icon>
          </div>
          <p>{{ successMessage }}</p>
          <button type="button" class="submit-btn" (click)="goToLogin()">
            Se connecter
          </button>
        </div> -->

        <!-- Formulaire -->
        <!-- <form 
          *ngIf="!showSuccessMessage && !hasError" 
          [formGroup]="passwordForm" 
          (ngSubmit)="updatePassword()" 
          class="login-form"
        > -->
          
          <!-- Message d'erreur général -->
          <!-- <div class="general-error" *ngIf="generalError">
            <mat-icon>error</mat-icon>
            <span>{{ generalError }}</span>
          </div> -->

          <!-- Nouveau mot de passe -->
          <!-- <div class="form-field">
            <label class="form-label" for="password">Nouveau mot de passe</label>
            <div class="input-wrapper">
              <div class="input-icon">
                <mat-icon>lock</mat-icon>
              </div>
              <input
                [type]="showPassword ? 'text' : 'password'"
                id="password"
                formControlName="password"
                placeholder="Votre nouveau mot de passe"
                class="form-input"
                [class.error]="isFieldInvalid('password')"
                autocomplete="new-password"
              />
              <button 
                type="button" 
                class="password-toggle"
                (click)="togglePasswordVisibility()"
                aria-label="Afficher/masquer le mot de passe"
              >
                <mat-icon>{{ showPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
            </div>
            <div class="field-error" *ngIf="isFieldInvalid('password')">
              <span *ngIf="passwordForm.get('password')?.errors?.['required']">
                Le mot de passe est requis
              </span>
              <span *ngIf="passwordForm.get('password')?.errors?.['minlength']">
                Le mot de passe doit contenir au moins 6 caractères
              </span>
            </div>
          </div> -->

          <!-- Confirmation mot de passe -->
          <!-- <div class="form-field">
            <label class="form-label" for="confirmPassword">Confirmer le mot de passe</label>
            <div class="input-wrapper">
              <div class="input-icon">
                <mat-icon>lock</mat-icon>
              </div>
              <input
                [type]="showConfirmPassword ? 'text' : 'password'"
                id="confirmPassword"
                formControlName="confirmPassword"
                placeholder="Confirmez votre mot de passe"
                class="form-input"
                [class.error]="isFieldInvalid('confirmPassword')"
                autocomplete="new-password"
              />
              <button 
                type="button" 
                class="password-toggle"
                (click)="toggleConfirmPasswordVisibility()"
                aria-label="Afficher/masquer la confirmation"
              >
                <mat-icon>{{ showConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
            </div>
            <div class="field-error" *ngIf="isFieldInvalid('confirmPassword')">
              <span *ngIf="passwordForm.get('confirmPassword')?.errors?.['required']">
                La confirmation est requise
              </span>
              <span *ngIf="passwordForm.get('confirmPassword')?.errors?.['passwordMismatch']">
                Les mots de passe ne correspondent pas
              </span>
            </div>
          </div> -->

          <!-- Bouton mise à jour -->
          <!-- <button
            type="submit"
            class="submit-btn"
            [disabled]="isLoading || passwordForm.invalid"
          >
            <div class="loading-spinner" *ngIf="isLoading"></div>
            <span>{{ isLoading ? 'Mise à jour...' : 'Mettre à jour le mot de passe' }}</span>
          </button>
        </form> -->

        <!-- Message d'erreur pour lien invalide -->
        <!-- <div class="error-message" *ngIf="hasError">
          <div class="error-icon">
            <mat-icon>error</mat-icon>
          </div>
          <h3>Lien invalide ou expiré</h3>
          <p>Le lien de réinitialisation est invalide ou a expiré. Veuillez demander un nouveau lien.</p>
          <button type="button" class="submit-btn" (click)="goToResetPassword()">
            Demander un nouveau lien
          </button>
        </div>
      </div>
    </div>
  </div> -->

  <div class="login-wrapper">
    <div class="login-container">
      <button class="close-btn" (click)="goToHome()" aria-label="Retour à l'accueil">
        <mat-icon>close</mat-icon>
      </button>
      
      <div class="login-header">
        <div class="logo-container">
          <div class="logo-icon"></div>
        </div>
        <h1 class="login-title">Nouveau mot de passe</h1>
        
        <!-- Loading pendant la vérification -->
        <div class="loading-content" *ngIf="isCheckingAuth">
          <div class="loading-spinner"></div>
          <p>Vérification de votre autorisation...</p>
        </div>
        
        <!-- Message de succès -->
        <div class="success-message" *ngIf="showSuccessMessage && !isCheckingAuth">
          <div class="success-icon">
            <mat-icon>check_circle</mat-icon>
          </div>
          <p>{{ successMessage }}</p>
          <button type="button" class="submit-btn" (click)="goToLogin()">
            Se connecter
          </button>
        </div>

        <!-- Formulaire -->
        <form 
          *ngIf="!showSuccessMessage && !hasError && !isCheckingAuth" 
          [formGroup]="passwordForm" 
          (ngSubmit)="updatePassword()" 
          class="login-form"
        >
          
          <!-- Message d'erreur général -->
          <div class="general-error" *ngIf="generalError">
            <mat-icon>error</mat-icon>
            <span>{{ generalError }}</span>
          </div>

          <!-- Nouveau mot de passe -->
          <div class="form-field">
            <label class="form-label" for="password">Nouveau mot de passe</label>
            <div class="input-wrapper">
              <div class="input-icon">
                <mat-icon>lock</mat-icon>
              </div>
              <input
                [type]="showPassword ? 'text' : 'password'"
                id="password"
                formControlName="password"
                placeholder="Votre nouveau mot de passe"
                class="form-input"
                [class.error]="isFieldInvalid('password')"
                autocomplete="new-password"
              />
              <button 
                type="button" 
                class="password-toggle"
                (click)="togglePasswordVisibility()"
                aria-label="Afficher/masquer le mot de passe"
              >
                <mat-icon>{{ showPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
            </div>
            <div class="field-error" *ngIf="isFieldInvalid('password')">
              <span *ngIf="passwordForm.get('password')?.errors?.['required']">
                Le mot de passe est requis
              </span>
              <span *ngIf="passwordForm.get('password')?.errors?.['minlength']">
                Le mot de passe doit contenir au moins 6 caractères
              </span>
            </div>
          </div>

          <!-- Confirmation mot de passe -->
          <div class="form-field">
            <label class="form-label" for="confirmPassword">Confirmer le mot de passe</label>
            <div class="input-wrapper">
              <div class="input-icon">
                <mat-icon>lock</mat-icon>
              </div>
              <input
                [type]="showConfirmPassword ? 'text' : 'password'"
                id="confirmPassword"
                formControlName="confirmPassword"
                placeholder="Confirmez votre mot de passe"
                class="form-input"
                [class.error]="isFieldInvalid('confirmPassword')"
                autocomplete="new-password"
              />
              <button 
                type="button" 
                class="password-toggle"
                (click)="toggleConfirmPasswordVisibility()"
                aria-label="Afficher/masquer la confirmation"
              >
                <mat-icon>{{ showConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
            </div>
            <div class="field-error" *ngIf="isFieldInvalid('confirmPassword')">
              <span *ngIf="passwordForm.get('confirmPassword')?.errors?.['required']">
                La confirmation est requise
              </span>
              <span *ngIf="passwordForm.get('confirmPassword')?.errors?.['passwordMismatch']">
                Les mots de passe ne correspondent pas
              </span>
            </div>
          </div>

          <!-- Bouton mise à jour -->
          <button
            type="submit"
            class="submit-btn"
            [disabled]="isLoading || passwordForm.invalid"
          >
            <div class="loading-spinner" *ngIf="isLoading"></div>
            <span>{{ isLoading ? 'Mise à jour...' : 'Mettre à jour le mot de passe' }}</span>
          </button>
        </form>

        <!-- Message d'erreur pour accès non autorisé -->
        <div class="error-message" *ngIf="hasError && !isCheckingAuth">
          <div class="error-icon">
            <mat-icon>error</mat-icon>
          </div>
          <h3>Accès non autorisé</h3>
          <p>Vous n'êtes pas autorisé à modifier votre mot de passe. Veuillez demander un nouveau lien de réinitialisation.</p>
          <button type="button" class="submit-btn" (click)="goToResetPassword()">
            Demander un nouveau lien
          </button>
        </div>
      </div>
    </div>
  </div>